!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([,function(e,t,i){var n='{"height":24,"infinite":false,"layers":[{"data":[1,1,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,7,7,1,1,1,1,1,1,1,1,3,2,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,3,2,2,3,2,2,2,2,2,2,2,3,2,1,1,1,1,1,1,1,3,2,7,1,1,1,7,1,1,1,7,2,3,1,1,3,1,1,1,1,1,1,1,3,2,7,7,7,7,7,7,7,3,2,7,1,1,1,7,1,1,1,7,2,3,1,7,3,1,1,1,7,7,7,7,3,2,2,2,2,2,2,2,2,2,2,7,1,1,1,7,1,1,1,7,2,3,3,2,2,1,1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,7,1,1,1,7,1,1,1,7,2,3,3,1,1,1,1,3,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,7,1,1,1,7,1,1,1,7,2,3,3,7,1,1,1,3,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,7,1,1,1,7,1,1,1,7,2,3,2,2,3,1,1,3,7,7,7,7,7,2,7,7,7,7,7,7,7,7,2,1,1,7,1,1,1,7,1,1,2,3,1,1,3,1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,1,7,3,1,3,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,1,1,1,1,1,1,1,1,1,1,7,3,3,2,2,1,3,7,7,1,7,7,1,1,1,1,3,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,7,3,3,1,1,7,2,2,2,3,2,2,2,7,7,7,3,1,1,7,7,7,7,7,1,1,2,2,2,2,2,2,7,3,3,7,1,7,7,7,7,3,7,7,7,7,7,7,3,1,3,2,2,2,2,2,1,1,2,2,7,7,7,2,7,3,2,2,3,7,2,2,2,3,2,2,2,7,7,7,3,1,3,1,1,7,7,7,7,7,1,2,2,7,7,2,7,3,1,1,3,7,2,7,2,3,2,7,2,7,7,7,3,1,3,1,3,2,2,2,2,2,1,1,2,2,7,2,7,3,1,7,3,7,2,2,2,3,2,2,2,7,7,7,3,1,3,1,3,1,1,7,7,7,7,7,1,2,2,2,7,3,3,2,2,7,1,1,1,3,1,1,1,7,7,7,3,1,3,1,3,1,3,2,2,2,2,2,1,1,1,1,7,3,3,1,1,7,2,2,2,3,2,2,2,7,7,7,3,1,3,1,3,1,3,1,1,7,7,7,7,7,1,1,7,3,3,7,1,7,2,7,2,3,2,7,2,7,7,7,3,1,3,1,3,1,3,1,3,2,2,2,2,2,1,1,7,3,2,2,3,7,2,7,2,3,2,7,2,7,7,7,3,1,3,1,3,1,3,1,3,1,1,7,7,7,7,7,7,3,1,1,3,7,2,2,2,3,2,2,2,7,7,7,3,1,3,1,3,1,3,1,3,1,3,2,2,2,2,2,7,3,4,1,3,1,1,1,1,3,1,1,1,1,1,1,3,1,3,1,3,1,3,1,3,1,3,1,1,1,1,1,7,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"height":24,"name":"level","opacity":1,"type":"tilelayer","visible":true,"width":32,"x":0,"y":0}],"nextobjectid":10,"orientation":"orthogonal","renderorder":"right-down","tiledversion":"1.1.6","tileheight":32,"tilesets":[{"columns":7,"firstgid":1,"image":"../../assets/tileset.png","imageheight":32,"imagewidth":224,"margin":0,"name":"js13k","spacing":0,"tilecount":7,"tileheight":32,"tileproperties":{"0":{"isStable":false,"name":"air"},"1":{"isStable":true,"name":"floor"},"2":{"isStable":true,"name":"ladder"},"3":{"isStable":false,"name":"door"},"4":{"isStable":false,"name":"player"},"5":{"isStable":false,"name":"enemy"},"6":{"isStable":false,"name":"battery"}},"tilepropertytypes":{"0":{"isStable":"bool","name":"string"},"1":{"isStable":"bool","name":"string"},"2":{"isStable":"bool","name":"string"},"3":{"isStable":"bool","name":"string"},"4":{"isStable":"bool","name":"string"},"5":{"isStable":"bool","name":"string"},"6":{"isStable":"bool","name":"string"}},"tilewidth":32}],"tilewidth":32,"type":"map","version":1,"width":32}',o=ga(1024,768,function(){let e=new(window.AudioContext||window.webkitAudioContext);function t(e,t,i){let n=o.sprite({image:"tileset.png",x:160,y:0,width:32,height:32});return n.spawnX=e,n.spawnY=t,n.x=n.spawnX,n.y=n.spawnY,n.id=i,n.movement={falling:!1,moving:!1,stuck:!1,stuckAt:void 0,direction:directions.still},n.allowMoveAgain=function(){n.movement.moving=!1},n.makeStuck=function(e){this.movement.moving=!1,this.movement.falling=!1,this.movement.stuck=!0,this.inHoleRef=e,this.movement.stuckAt=Date.now()},n.unStick=function(){this.movement.stuck=!1,this.inHoleRef=void 0,this.movement.stuckAt=void 0,this.climbingOut=!0},n.climbingOut=!1,n.currentTile=o.getSpriteIndex(n),n.dead=!1,n.freshSpawn=!0,n.inHoleRef=void 0,n.needsPath=!0,n.pathData={path:null,updated:null,distance:null},n}c=new class{constructor(e){this.ctx=e}init(){this.oscillator=this.ctx.createOscillator(),this.gainNode=this.ctx.createGain(),this.oscillator.connect(this.gainNode),this.gainNode.connect(this.ctx.destination),this.oscillator.type="sine"}play(e,t){this.init(),this.oscillator.frequency.value=e,this.gainNode.gain.setValueAtTime(.5,this.ctx.currentTime),this.oscillator.start(t),this.stop(t)}stop(e){this.gainNode.gain.exponentialRampToValueAtTime(.001,e+.25),this.oscillator.stop(e+.25)}battery(){this.play(8e3,this.ctx.currentTime)}move(){this.play(5,this.ctx.currentTime)}doorOpen(){this.play(261.63,this.ctx.currentTime+.25),this.play(329.63,this.ctx.currentTime+.35)}win(){this.play(261.63,this.ctx.currentTime+.25),this.play(329.63,this.ctx.currentTime+.35),this.play(392,this.ctx.currentTime+.45),this.play(523.25,this.ctx.currentTime+.55)}lose(){this.play(261.63,this.ctx.currentTime+.25),this.play(246.94,this.ctx.currentTime+.35),this.play(233.08,this.ctx.currentTime+.45)}blast(){this.play(185,this.ctx.currentTime+.25)}}(e),o.canvas.style.border="none",o.backgroundColor="black",endMessage=o.text("Placeholder Text","32px Consolas","#15e815",0,0),(d=o.group(endMessage)).visible=!1,(u=o.text("Sir! That earthquake knocked the building offline! The bio-restraint has failed!","22px Consolas","#15e815",0,0)).x=15,u.y=150,(h=o.text("Electronics are dead, batteries scattered, and the security-organics are haywire!","22px Consolas","#15e815",0,0)).x=15,h.y=250,introMessage3=o.text("The door cycle will drain the reserve. Go retrive the batteries so we can fix this!","22px Consolas","#15e815",0,0),introMessage3.x=15,introMessage3.y=350,introMessage4=o.text("You're the best Organic Electro-Chemical Technician we've got. Stay safe in there!","22px Consolas","#15e815",0,0),introMessage4.x=15,introMessage4.y=450,introScene=o.group(u,h,introMessage3,introMessage4),introScene.visible=!1,y=o.text("- OFFLINE: O.E.C.T. -","64px Consolas","#15e815",0,0),p=o.text("By Ben Fox.","32px Consolas","#15e815",0,0),m=o.text("[ SPACE ] to page/pause.","32px Consolas","#15e815",0,0),f=o.text("[ A/D ] to blast the floor. [ ARROWS ] to move.","32px Consolas","#15e815",0,0),y.x=135,y.y=250,p.x=400,p.y=350,m.x=290,m.y=400,f.x=100,f.y=450,titleScreen=o.group(y,p,m,f),titleScreen.visible=!1,world=o.makeTiledWorld(n,"tileset.png"),a=o.group(),l=world.getObjects(o.tileTypes.door),v=world.getObjects(o.tileTypes.floor),g=world.getObjects(o.tileTypes.ladder),T=world.getObjects(o.tileTypes.battery),l.forEach(e=>{a.addChild(e),e.canUse=!1,e.alpha=.25,k[e.index]=e}),v.forEach(e=>{a.addChild(e)}),T.forEach(e=>{a.addChild(e),w[e.index]=e}),S=Object.keys(w).length,g.forEach(e=>{a.addChild(e)}),directions={up:"u",down:"d",left:"l",right:"r",current:"c",still:"still"},s=function(e,t){let i=o.sprite({image:"tileset.png",x:128,y:0,width:32,height:32});return i.spawnX=e,i.spawnY=t,i.x=i.spawnX,i.y=i.spawnY,i.dead=!1,i.won=!1,i.landingTile=void 0,i.movement={falling:!1,moving:!1,direction:directions.still},i.freshSpawn=!0,i.currentTile=o.getSpriteIndex(i),i}(32,704),a.addChild(s),r.push(t(672,256,1)),r.push(t(0,128,2)),r.push(t(320,352,3)),r.push(t(288,32,4)),r.push(t(928,704,5)),r.forEach(e=>{a.addChild(e)}),levelGraph=function(){const e={},t=world.objects;let i=0;for(t.length;i<t.length;i++){let n=t[i];"level"!==n.name&&(e[n.index]={},adjTiles=o.getAdjacentTiles(n.index),adjTiles.d.isStable?(q(s,adjTiles.c,adjTiles.u)&&(e[n.index][adjTiles.u.index]=1),q(s,adjTiles.c,adjTiles.d)&&(e[n.index][adjTiles.d.index]=1),q(s,adjTiles.c,adjTiles.l)&&(e[n.index][adjTiles.l.index]=1),q(s,adjTiles.c,adjTiles.r)&&(e[n.index][adjTiles.r.index]=1)):adjTiles.d.isStable||(e[n.index][adjTiles.d.index]=1))}return e}(),dijkstra2=new function(e){this.vertices=e,this.addVertex=function(e,t){this.vertices[e]=t},this.shortestPath=function(e,t){e=e.toString(),t=t.toString();var i,n,o,s,r=new function(){this._nodes=[],this.enqueue=function(e,t){this._nodes.push({key:t,priority:e}),this.sort()},this.dequeue=function(){return this._nodes.shift().key},this.sort=function(){this._nodes.sort(function(e,t){return e.priority-t.priority})},this.isEmpty=function(){return!this._nodes.length}},l={},a={},d=[];for(n in this.vertices)n===e?(l[n]=0,r.enqueue(0,n)):(l[n]=1/0,r.enqueue(1/0,n)),a[n]=null;for(;!r.isEmpty();){if((i=r.dequeue())===t){for(d=[];a[i];)d.push(Number(i)),i=a[i];break}if(i&&l[i]!==1/0)for(o in this.vertices[i])(s=l[i]+this.vertices[i][o])<l[o]&&(l[o]=s,a[o]=i,r.enqueue(s,o))}return{path:d.concat([Number(e)]).reverse(),distance:d.length,updated:Date.now()}}}(levelGraph),o.key.space.press=function(){o.state===M?(o.shake(titleScreen,16,!1,120),x?(clearTimeout(x),o.state=O):x=o.wait(2e3,()=>{o.state=O})):o.state===O?(x&&(x=void 0),o.state=_,a.visible=!0,introScene.visible=!1):o.state===_?o.paused&&!s.dead?o.resume():o.pause():o.state!==A&&o.state!==D||location.reload()},o.key.rightArrow.press=function(){s.movement.direction=directions.right},o.key.leftArrow.press=function(){s.movement.direction=directions.left},o.key.upArrow.press=function(){s.movement.direction=directions.up},o.key.downArrow.press=function(){s.movement.direction=directions.down},o.key.a.press=function(){C("dl")},o.key.d.press=function(){C("dr")},o.key.rightArrow.release=function(){s.movement.direction===directions.right&&(s.movement.direction=directions.still)},o.key.leftArrow.release=function(){s.movement.direction===directions.left&&(s.movement.direction=directions.still)},o.key.upArrow.release=function(){s.movement.direction===directions.up&&(s.movement.direction=directions.still)},o.key.downArrow.release=function(){s.movement.direction===directions.down&&(s.movement.direction=directions.still)},o.state=M},["tileset.png"]);document.getElementById("restart").addEventListener("click",()=>{location.reload()});var s,r,l,a,d,c,u,h,p,m,f,y,v,g,T,x,b={playerMoveSpeed:150,enemyMoveSpeed:250,blockRespawnSpeed:3300,introTextFadein:2e3,pathUpdateFrequency:750,enemyUnstuckSpeed:void 0,difficulties:{easy:"easy",normal:"normal",hard:"hard"},difficulty:void 0};b.difficulty=b.difficulties.normal,b.enemyUnstuckSpeed=b.blockRespawnSpeed/3,o.start(),destroyedBlocks={queue:[],hash:{}};const w={},k={};let S=0,j=0;function D(){a.visible=!1,d.visible=!0,titleScreen.visible=!1,endMessage.content="Oh no! You're part of the building, now.",endMessage.x=155,endMessage.y=o.canvas.height/2-35}function A(){a.visible=!1,titleScreen.visible=!1,d.visible=!0,endMessage.content="You made it! Nice work!",endMessage.x=300,endMessage.y=o.canvas.height/2-35}function M(){titleScreen.visible=!0,a.visible=!1,d.visible=!1,introScene.visible=!1}function O(){a.visible=!1,titleScreen.visible=!1,d.visible=!1,introScene.visible=!0}function C(e){if(currentTile=o.getSpriteIndex(s),tileToDestroy=o.getAdjacentTile(currentTile,e),aboveTile=o.getAdjacentTile(tileToDestroy.index,directions.up),!destroyedBlocks.hash[tileToDestroy.index]&&aboveTile.type!==o.tileTypes.floor&&(spriteToDestroy=v.find(e=>e.index===tileToDestroy.index),spriteToDestroy&&spriteToDestroy.visible)){let n=1;"dl"===e&&(n*=-1);var t=o.line("yellow",3,s.centerX+10*n,s.centerY+2,spriteToDestroy.centerX+2*n,spriteToDestroy.centerY-16);o.wait(35,()=>{o.remove(t)}),c.blast(),world.children[0].data[tileToDestroy.index]=1,o.fadeOut(spriteToDestroy,15);let r={sprite:spriteToDestroy,tile:tileToDestroy,time:Date.now(),occupied:!1,occupy:function(){this.occupied=!0,world.children[0].data[this.tile.index]=2},vacate:function(){this.occupied=!1,world.children[0].data[this.tile.index]=1}};i=r,destroyedBlocks.hash[i.tile.index]=i,destroyedBlocks.queue.push(i.tile.index)}var i}function B(){let e=destroyedBlocks.queue[0],t=destroyedBlocks.hash[e];e===s.currentTile&&(c.lose(),s.dead=!0,s.visible=!1,setTimeout(function(){o.resume(),o.state=D},1500),o.pause()),delete destroyedBlocks.hash[destroyedBlocks.queue.shift()],world.children[0].data[t.tile.index]=2;o.fadeIn(t.sprite,6)}function q(e,t,i){switch(t.index-i.index){case 32:if(i.type&&t.type===o.tileTypes.ladder&&i.type!==o.tileTypes.floor)return!0;break;case-32:if(i.type&&t.type===o.tileTypes.ladder&&i.type!==o.tileTypes.floor||i.type&&i.type===o.tileTypes.ladder||i.type&&e.movement.falling)return!0;break;case-1:case 1:if(i.type&&i.type!==o.tileTypes.floor)return!0;break;default:return!1}}function E(e,t,i){let n=o.getAdjacentTile(t,directions.current),s=o.getAdjacentTile(t,i);if(canMove=q(e,n,s),canMove){let i=s.index,n=(o.getTile(t,world.objects[0].data,world),o.getTile(i,world.objects[0].data,world));return nextX=n.x,nextY=n.y,e.x=nextX,e.y=nextY,e.currentTile=i,!0}return!1}function P(e){return thisTile=o.getAdjacentTile(e.currentTile,directions.current),belowTile=o.getAdjacentTile(e.currentTile,directions.down),!(thisTile.type===o.tileTypes.ladder||belowTile.isStable||!belowTile.index)}function R(){s.movement.moving=!1}function Y(e){var t;!e.dead&&destroyedBlocks.hash[e.inHoleRef.tile.index]?(e.inHoleRef.vacate(),e.unStick()):(e.dead=!0,e.visible=!1,(t=e).needsPath=!0,t.x=t.spawnX,t.y=t.spawnY,t.currentTile=o.getSpriteIndex(t),t.inHoleRef=void 0,t.freshSpawn=!0,t.movement={falling:!1,moving:!1,stuck:!1,stuckAt:void 0,direction:directions.still},t.pathData={path:null,updated:null,distance:null},setTimeout(function(){t.visible=!0},250),setTimeout(function(){t.dead=!1},1e3))}function _(){!function(){if(s.freshSpawn&&(s.movement.falling=P(s),s.freshSpawn=!1),!s.movement.moving){let e;if(s.movement.falling?e=E(s,s.currentTile,directions.down):s.movement.direction!==directions.still&&(e=E(s,s.currentTile,s.movement.direction)),e&&(c.move(),s.movement.moving=!0,o.wait(b.playerMoveSpeed,R)),s.movement.falling=P(s),s.movement.falling&&!s.landingTile)for(idx=s.currentTile;!s.landingTile;){let e=world.tileTypes[world.objects[0].data[idx]-1];e&&e.isStable?s.landingTile=idx-32:e?idx+=32:s.landingTile=idx-32}else s.movement.falling||(s.landingTile=void 0)}}(),w[s.currentTile]&&w[s.currentTile].visible&&(w[s.currentTile].visible=!1,j++,c.battery(),S===j&&(c.doorOpen(),l.forEach(e=>{e.alpha=1,e.canUse=!0}))),!s.won&&k[s.currentTile]&&k[s.currentTile].canUse&&(s.won=!0,c.win(),o.state=A),r.forEach(e=>{e.dead||(function(e){if(e.freshSpawn&&(e.movement.falling=P(e),e.freshSpawn=!1),!e.movement.moving){if(e.movement.stuck||(e.movement.falling=P(e)),!e.movement.falling&&e.needsPath){let t=0;e.movement.stuck&&(t=32),b.difficulty===b.difficulties.hard?e.pathData=dijkstra2.shortestPath(e.currentTile-t,s.movement.falling?s.landingTile:s.currentTile):e.pathData=dijkstra2.shortestPath(e.currentTile-t,s.currentTile),e.needsPath=!1}!e.movement.falling&&Date.now()-e.pathData.updated>b.pathUpdateFrequency&&(e.needsPath=!0),e.movement.stuck&&Date.now()-e.movement.stuckAt>b.enemyUnstuckSpeed&&Y(e);let n=!1,r=e.pathData.path?e.pathData.path[0]:void 0,l=e.pathData.path?e.pathData.path[1]:void 0;e.movement.stuck||(e.movement.falling?(destroyedBlocks.hash[e.currentTile+32]&&!destroyedBlocks.hash[e.currentTile+32].occupied||!destroyedBlocks.hash[e.currentTile+32])&&(n=E(e,e.currentTile,directions.down)):l&&(e.movement.direction=(i=l)<(t=r)?i+1===t?directions.left:directions.up:i>t?i-1===t?directions.right:directions.down:void 0,n=E(e,r,e.movement.direction)),n&&(!e.movement.falling&&e.pathData.path&&e.pathData.path.shift(),e.movement.moving=!0,o.wait(b.enemyMoveSpeed,e.allowMoveAgain))),e.movement.stuck||(e.movement.falling=P(e))}var t,i}(e),e.movement.stuck||(function(e){let t;b.difficulty===b.difficulties.hard&&(t=!0),e.currentTile!==s.currentTile||!t&&(t||s.movement.falling)||(c.lose(),s.dead=!0,setTimeout(function(){o.resume(),o.state=D},1500),o.pause())}(e),function(e){let t=destroyedBlocks.hash[e.currentTile];t&&(e.makeStuck(t),t.occupy())}(e)))}),function(){try{destroyedBlocks.queue.length&&Date.now()-destroyedBlocks.hash[destroyedBlocks.queue[0]].time>b.blockRespawnSpeed&&B()}catch(e){}}()}r=[]}]);